language: android
jdk: oraclejdk8
env:
  global:
  - ANDROID_TARGET=android-30
  - EMU_API_LEVEL=android-24
  - ANDROID_TAG=google_apis
  - ANDROID_ABI=armeabi-v7a
android:
  components:
  - build-tools-30.0.3
  - build-tools-23.0.1
  - "$ANDROID_TARGET"
  - "$EMU_API_LEVEL"
  - extra-android-support
  - extra-google-m2repository
  - extra-android-m2repository
  - sys-img-$ANDROID_ABI-android-24
licenses:
- android-sdk-license-.+
before_install:
- cd code
# - yes | sdkmanager "platforms;android-30"
# - chmod +x gradlew
# - wget https://services.gradle.org/distributions/gradle-5.3-bin.zip
# - unzip -qq gradle-5.3-bin.zip
# - export GRADLE_HOME=$PWD/gradle-5.3
# - export PATH=$GRADLE_HOME/bin:$PATH
# - gradle -v
- echo no | android create avd --force -n test -t $EMU_API_LEVEL --abi $ANDROID_ABI
- openssl aes-256-cbc -K $encrypted_f761570c4ae9_key -iv $encrypted_f761570c4ae9_iv
  -in google-services.json.enc -out google-services.json -d
# also decrypt in app
- cd app
- openssl aes-256-cbc -K $encrypted_f761570c4ae9_key -iv $encrypted_f761570c4ae9_iv
  -in google-services.json.enc -out google-services.json -d
- cd ../
- emulator -avd test -no-skin -no-audio -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &

script:
  ./gradlew :projectcore:checkstyle
  ./gradlew clean build -x lint
  ./gradlew :project:connectedAndroidTest